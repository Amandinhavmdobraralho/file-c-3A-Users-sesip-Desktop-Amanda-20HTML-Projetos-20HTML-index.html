;/*FB_PKG_DELIM*/

__d("WAWebMexFetchNewsletterInsightsJobQuery.graphql",[],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"input"}],b=[{alias:null,args:[{kind:"Variable",name:"input",variableName:"input"}],concreteType:"XWA2NewsletterAdminInsightsResponse",kind:"LinkedField",name:"xwa2_newsletter_admin_insights",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"newsletter_id",storageKey:null},{alias:null,args:null,concreteType:"XWA2NewsletterState",kind:"LinkedField",name:"state",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"type",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"last_update_time",storageKey:null},{alias:null,args:null,concreteType:"XWA2NewsletterAdminInsightsMetricResult",kind:"LinkedField",name:"result",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,concreteType:"XWA2NewsletterAdminInsightsValues",kind:"LinkedField",name:"values",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"country",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"role",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"timestamp",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"WAWebMexFetchNewsletterInsightsJobQuery",selections:b,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"WAWebMexFetchNewsletterInsightsJobQuery",selections:b},params:{id:"7570405569709144",metadata:{},name:"WAWebMexFetchNewsletterInsightsJobQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("WAWebMexFetchNewsletterInsightsJob",["WALogger","WATimeUtils","WAWebMexClient","WAWebMexFetchNewsletterInsightsJobQuery.graphql","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MEX][NEWSLETTER] fetched newsletter admin insights mex"]);i=function(){return a};return a}var j=h!==void 0?h:h=b("WAWebMexFetchNewsletterInsightsJobQuery.graphql");function a(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.newsletterJid;a=a.requestedMetrics;b=(yield d("WAWebMexClient").fetchQuery(j,{input:{newsletter_id:b,metrics:a}}));d("WALogger").DEV(i()).tags("GQL","MEX").devConsole({response:b});a=(a=(a=b.xwa2_newsletter_admin_insights)==null?void 0:a.result)!=null?a:[];b=(b=b.xwa2_newsletter_admin_insights)==null?void 0:b.last_update_time;a=a.reduce(function(a,b){var c=b.id;b=b.values;if(c==null||b==null)return a;a.set(c,b);return a},new Map());return{metricValueMap:a,lastUpdateTime:b==null?d("WATimeUtils").unixTime():d("WATimeUtils").castToUnixTime(Number.parseInt(b,10))}});return k.apply(this,arguments)}g.mexFetchNewsletterInsights=a}),98);
__d("WAWebNewsletterAdminInsightsFailedToLoad.react",["fbt","WAWebFbtCommon","WAWebFlex.react","WAWebWDSButton","WAWebWDSText.react","react"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react");function a(a){a=a.onClick;return j.jsxs(d("WAWebFlex.react").FlexColumn,{justify:"center",align:"center",paddingBottom:4,children:[j.jsx(d("WAWebWDSText.react").WDSTextMuted,{marginTop:12,marginBottom:2,children:h._("__JHASH__KkVRvek8hWh__JHASH__")}),j.jsx(d("WAWebWDSButton").WDSButtonSimplified,{onClick:a,children:c("WAWebFbtCommon")("Try again")})]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("WAWebNewsletterMetricUtils",["$InternalEnum","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=60*60*24,i=30;function a(a){a=d("WATimeUtils").pastUnixTime(h*i,a);return a}var j=b("$InternalEnum")({UniqueVisitorsOverPeriod:1,NewUniqueVisitorsOverPeriod:2,NetFollowsOverPeriod:3,UniqueVisitorOverPeriodByRole:4,UniqueVisitorOverPeriodByCountry:5,FollowersOverPeriod:6,FollowersOverPeriodByCountry:7,FollowsPerDay:8,UnfollowsPerDay:9,NetFollowsPerDay:10});function c(a){a=a.flatMap(function(a){return a.metrics});a=a.reduce(function(a,b){var c=a.enumSet,d=a.metricRequests,e=j.cast(b.id);if(e==null)return a;if(c.has(e))return a;c.add(e);d.push(b);return a},{enumSet:new Set(),metricRequests:[]});a=a.metricRequests;return a}g.INSIGHT_DAYS_COVERED=i;g.getInsightPeriodStart=a;g.NewsletterInsightMetricQuery=j;g.getUniqueMetricRequests=c}),98);
__d("WAWebNewsletterGrowthChartProcessors",["WAWebNewsletterMetricUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(a){a=a.reduce(function(a,b){var c=b.timestamp;b=b.value;if(c==null)return a;c=Number.parseInt(c,10);if(Number.isNaN(c))return a;a.push([c,b]);return a},[]);a.sort(function(a,b){return a[0]-b[0]});return a}b={metrics:[{id:(a=d("WAWebNewsletterMetricUtils")).NewsletterInsightMetricQuery.FollowsPerDay,type:"FOLLOWS",group_by:{number_of_days:1},limit:a.INSIGHT_DAYS_COVERED},{id:a.NewsletterInsightMetricQuery.UnfollowsPerDay,type:"UNFOLLOWS",group_by:{number_of_days:1},limit:a.INSIGHT_DAYS_COVERED},{id:a.NewsletterInsightMetricQuery.NetFollowsPerDay,type:"UNFOLLOWS",group_by:{number_of_days:1},limit:a.INSIGHT_DAYS_COVERED}],process:function(a){var b;a=[{data:[h((b=a.get(d("WAWebNewsletterMetricUtils").NewsletterInsightMetricQuery.NetFollowsPerDay))!=null?b:[]),h((b=a.get(d("WAWebNewsletterMetricUtils").NewsletterInsightMetricQuery.FollowsPerDay))!=null?b:[]),h((b=a.get(d("WAWebNewsletterMetricUtils").NewsletterInsightMetricQuery.UnfollowsPerDay))!=null?b:[])],dataLabels:["Net follows","Follows","Unfollows"],dataSetLabel:"Growth"}];return{growthChart:a}}};g.FOLLOWER_GROWTH_PROCESSOR=b}),98);
__d("WAWebNewsletterInsightCountryDataProcessors",["WAWebCountriesUtils","WAWebNewsletterMetricUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";c=10;var h=10;function i(){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebCountriesUtils").getCountries({filter:d("WAWebCountriesUtils").COUNTRY_FILTER_TYPE.WHATSAPP_REGISTRATION}));return new Map(a)});return j.apply(this,arguments)}function a(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield i());a=a.reduce(function(a,c){var d=c.countryCode,e=c.value;c=c.percentage;if(d==null)return a;d=b.get(d);if(d==null)return a;a.push({label:d,value:e,percentage:c});return a},[]);return a.sort(function(a,b){return a.label.toString().localeCompare(b.label.toString())})});return k.apply(this,arguments)}function l(a,b){a=a.reduce(function(a,c){var d=c.country;c=c.value;if(d==null)return a;if(c<h)return a;a.push({countryCode:d.toUpperCase(),percentage:c/b,value:c});return a},[]);return a.sort(function(a,b){return b.value-a.value})}f={metrics:[{id:(e=d("WAWebNewsletterMetricUtils")).NewsletterInsightMetricQuery.UniqueVisitorsOverPeriod,type:"UNIQUE_VISITORS",group_by:{number_of_days:e.INSIGHT_DAYS_COVERED}},{id:e.NewsletterInsightMetricQuery.UniqueVisitorOverPeriodByCountry,type:"UNIQUE_VISITORS",group_by:{number_of_days:e.INSIGHT_DAYS_COVERED,country:!0},limit:c}],process:function(a){var b;b=(b=a.get(d("WAWebNewsletterMetricUtils").NewsletterInsightMetricQuery.UniqueVisitorsOverPeriod))==null?void 0:b[0].value;if(b==null)return{};a=(a=a.get(d("WAWebNewsletterMetricUtils").NewsletterInsightMetricQuery.UniqueVisitorOverPeriodByCountry))!=null?a:[];return{reachByCountry:l(a,b)}}};e={metrics:[{id:e.NewsletterInsightMetricQuery.FollowersOverPeriod,type:"FOLLOWER",group_by:{number_of_days:e.INSIGHT_DAYS_COVERED}},{id:e.NewsletterInsightMetricQuery.FollowersOverPeriodByCountry,type:"FOLLOWER",group_by:{number_of_days:e.INSIGHT_DAYS_COVERED,country:!0},limit:c}],process:function(a){var b;b=(b=a.get(d("WAWebNewsletterMetricUtils").NewsletterInsightMetricQuery.FollowersOverPeriod))==null?void 0:b[0].value;if(b==null)return{};a=(a=a.get(d("WAWebNewsletterMetricUtils").NewsletterInsightMetricQuery.FollowersOverPeriodByCountry))!=null?a:[];return{followersByCountry:l(a,b)}}};g.getCountryCodeMap=i;g.getCountryBarValues=a;g.REACH_BY_COUNTRY_PROCESSOR=f;g.FOLLOWER_BY_COUNTRY_PROCESSOR=e}),98);
__d("WAWebNewsletterInsightDeltaProcessors",["WAWebNewsletterMetricUtils"],(function(a,b,c,d,e,f,g){"use strict";b={metrics:[{id:(a=d("WAWebNewsletterMetricUtils")).NewsletterInsightMetricQuery.UniqueVisitorsOverPeriod,type:"UNIQUE_VISITORS",group_by:{number_of_days:a.INSIGHT_DAYS_COVERED}},{id:a.NewsletterInsightMetricQuery.NewUniqueVisitorsOverPeriod,type:"NEW_UNIQUE_VISITORS",group_by:{number_of_days:a.INSIGHT_DAYS_COVERED}}],process:function(a){a=(a=a.get(d("WAWebNewsletterMetricUtils").NewsletterInsightMetricQuery.UniqueVisitorsOverPeriod))==null?void 0:a[0].value;return{accountsReached:a}}};c={metrics:[{id:a.NewsletterInsightMetricQuery.FollowersOverPeriod,type:"FOLLOWER",group_by:{number_of_days:a.INSIGHT_DAYS_COVERED}},{id:a.NewsletterInsightMetricQuery.NetFollowsOverPeriod,type:"NET_FOLLOWS",group_by:{number_of_days:a.INSIGHT_DAYS_COVERED}}],process:function(a){var b;b=(b=a.get(d("WAWebNewsletterMetricUtils").NewsletterInsightMetricQuery.FollowersOverPeriod))==null?void 0:b[0].value;a=(a=a.get(d("WAWebNewsletterMetricUtils").NewsletterInsightMetricQuery.NetFollowsOverPeriod))==null?void 0:a[0].value;if(b==null||a==null)return{};var c=a/(b-a);return{followers:b,netFollows:a,followersDelta:c}}};e={metrics:[{id:a.NewsletterInsightMetricQuery.NetFollowsOverPeriod,type:"NET_FOLLOWS",group_by:{number_of_days:a.INSIGHT_DAYS_COVERED}}],process:function(a){a=(a=a.get(d("WAWebNewsletterMetricUtils").NewsletterInsightMetricQuery.NetFollowsOverPeriod))==null?void 0:a[0].value;return{netFollows:a}}};g.REACH_WITH_DELTA_PROCESSOR=b;g.FOLLOWER_WITH_DELTA_PROCESSOR=c;g.NET_FOLLOWS_PROCESSOR=e}),98);
__d("WAWebNewsletterInsightsJob",["WAJobOrchestratorTypes","WAWebMexFetchNewsletterInsightsJob","WAWebOrchestratorNonPersistedJob"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("getNewsletterAdminInsights",function(){return d("WAWebMexFetchNewsletterInsightsJob").mexFetchNewsletterInsights(a)},{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION}).waitUntilCompleted()}g.getNewsletterInsights=a}),98);
__d("WAWebNewsletterRoleDataProcessors",["WAWebNewsletterMetricUtils"],(function(a,b,c,d,e,f,g){"use strict";a={metrics:[{id:d("WAWebNewsletterMetricUtils").NewsletterInsightMetricQuery.UniqueVisitorOverPeriodByRole,type:"UNIQUE_VISITORS",group_by:{number_of_days:d("WAWebNewsletterMetricUtils").INSIGHT_DAYS_COVERED,role:!0}}],process:function(a){var b;a=a.get(d("WAWebNewsletterMetricUtils").NewsletterInsightMetricQuery.UniqueVisitorOverPeriodByRole);return{followersReached:a==null?void 0:(b=a.find(function(a){return a.role==="SUBSCRIBER"}))==null?void 0:b.value,nonFollowersReached:a==null?void 0:(b=a.find(function(a){return a.role==="GUEST"}))==null?void 0:b.value}}};g.REACH_BY_ROLE_PROCESSOR=a}),98);
__d("WAWebPopulateNewsletterInsightsAction",["WAJids","WALogger","WAWebNewsletterBridgeApi","WAWebNewsletterGrowthChartProcessors","WAWebNewsletterInsightCountryDataProcessors","WAWebNewsletterInsightDeltaProcessors","WAWebNewsletterInsightsJob","WAWebNewsletterMetricUtils","WAWebNewsletterRoleDataProcessors","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletter][getAndUpdateNewsletterInsights] called with a non-newsletter chat"]);h=function(){return a};return a}function a(a){return i(a,[d("WAWebNewsletterInsightDeltaProcessors").REACH_WITH_DELTA_PROCESSOR,d("WAWebNewsletterInsightDeltaProcessors").NET_FOLLOWS_PROCESSOR])}function e(a){return i(a,[d("WAWebNewsletterInsightDeltaProcessors").REACH_WITH_DELTA_PROCESSOR,d("WAWebNewsletterRoleDataProcessors").REACH_BY_ROLE_PROCESSOR,d("WAWebNewsletterInsightCountryDataProcessors").REACH_BY_COUNTRY_PROCESSOR,d("WAWebNewsletterInsightDeltaProcessors").FOLLOWER_WITH_DELTA_PROCESSOR,d("WAWebNewsletterInsightCountryDataProcessors").FOLLOWER_BY_COUNTRY_PROCESSOR,d("WAWebNewsletterGrowthChartProcessors").FOLLOWER_GROWTH_PROCESSOR])}function i(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(!a.isNewsletter){d("WALogger").ERROR(h()).tags("newsletter").devConsole(a.id).sendLogs("getting-insights-for-non-newsletter");throw c("err")("getting-insights-for-non-newsletter")}var e=d("WAWebNewsletterMetricUtils").getUniqueMetricRequests(b),f=d("WAJids").toNewsletterJid(a.id.toJid());f={newsletterJid:f,requestedMetrics:e};e=(yield d("WAWebNewsletterInsightsJob").getNewsletterInsights(f));var g=e.metricValueMap;f=e.lastUpdateTime;e=b.map(function(a){return a.process(g)});b={id:a.id,rangeStart:d("WAWebNewsletterMetricUtils").getInsightPeriodStart(f),rangeEnd:f};Object.assign.apply(Object,[b].concat(e));yield d("WAWebNewsletterBridgeApi").NewsletterBridgeApi.updateNewsletterInsights({newsletter:a,insights:b})});return j.apply(this,arguments)}g.populateNewsletterTileInsights=a;g.populateNewsletterTabInsights=e}),98);
__d("useWAWebAdminInsightsHooks",["WATimeUtils","useWAWebModelValues"],(function(a,b,c,d,e,f,g){"use strict";var h=60*60*24,i=30;function a(a){var b=d("useWAWebModelValues").useModelValues(a,["adminInsights"]);b=d("useWAWebModelValues").useOptionalModelValues(b.adminInsights,["rangeStart","rangeEnd"]);return j(b==null?void 0:b.rangeStart,b==null?void 0:b.rangeEnd,a.creationTime)}function j(a,b,c){var e=d("WATimeUtils").unixTime();a=(a=a)!=null?a:d("WATimeUtils").castToUnixTime(Math.max(c,d("WATimeUtils").pastUnixTime(h*i,e)));b=(c=b)!=null?c:e;return[a,b]}g.useAdminInsightPeriod=a}),98);
__d("useWAWebAsyncRetry",["react","useWAWebAsync"],(function(a,b,c,d,e,f,g){"use strict";var h;b=h||d("react");var i=b.useCallback,j=b.useState;function a(a,b){var d=j(0),e=d[0],f=d[1];d=i(function(){f(e+1)},[e]);b=c("useWAWebAsync")(function(){return a()},[].concat(b,[e]));return babelHelpers["extends"]({},b,{retry:d})}g["default"]=a}),98);